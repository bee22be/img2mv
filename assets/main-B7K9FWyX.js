(function(){const o=document.createElement("link").relList;if(!(o&&o.supports&&o.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const i=function(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,i)}})();const v=2e6,L=document.getElementById("imageInput"),n=document.getElementById("canvas"),p=n.getContext("2d"),w=document.getElementById("export"),y=document.getElementById("status");let u;function S(o){o&&o.type.startsWith("image/")?(u=new Image,u.onload=()=>{let t=u.naturalWidth,e=u.naturalHeight;const i=t,r=e,a=t*e;let g=!1;if(a>v){const s=Math.sqrt(v/a);t=Math.floor(t*s),e=Math.floor(e*s),g=!0}t%2!=0&&t--,e%2!=0&&e--,n.width=t,n.height=e,p.imageSmoothingEnabled=!0,p.imageSmoothingQuality="high",p.clearRect(0,0,t,e),p.drawImage(u,0,0,t,e),y.textContent=`画像読み込み完了 (${t} × ${e})`,g&&function(s,c=3e3){const d=document.createElement("div");d.textContent=s,Object.assign(d.style,{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.8)",color:"#fff",padding:"10px 16px",borderRadius:"8px",fontSize:"14px",zIndex:9999,opacity:"0",transition:"opacity 0.3s ease"}),document.body.appendChild(d),requestAnimationFrame(()=>{d.style.opacity="1"}),setTimeout(()=>{d.style.opacity="0",setTimeout(()=>d.remove(),300)},c)}(`高解像度のため縮小しました
${i}×${r} → ${t}×${e}`,4e3)},u.src=URL.createObjectURL(o)):alert("画像ファイルを選択してください")}L.addEventListener("change",()=>{S(L.files[0])}),["dragenter","dragover","dragleave","drop"].forEach(o=>{n.addEventListener(o,t=>{t.preventDefault(),t.stopPropagation()})}),["dragenter","dragover"].forEach(o=>{n.addEventListener(o,()=>{n.classList.add("dragover")})}),["dragleave","drop"].forEach(o=>{n.addEventListener(o,()=>{n.classList.remove("dragover")})}),n.addEventListener("drop",o=>{S(o.dataTransfer.files[0])}),w.addEventListener("click",async()=>{if(!u)return alert("画像を読み込んでください");y.textContent="MP4生成中… 0%";const o=Math.floor(30),t=new Mp4Muxer.Muxer({target:new Mp4Muxer.ArrayBufferTarget,video:{codec:"avc",width:n.width,height:n.height},fastStart:"in-memory"}),e=new VideoEncoder({output:(l,f)=>t.addVideoChunk(l,f),error:l=>console.error(l)});e.configure({codec:"avc1.640028",width:n.width,height:n.height,bitrate:12e6,framerate:60});const i=await createImageBitmap(n);for(let l=0;l<o;l++){const f=new VideoFrame(i,{timestamp:16666.666666666668*l});e.encode(f),f.close(),y.textContent="MP4生成中… "+Math.round(l/o*100)+"%"}await e.flush(),e.close(),i.close(),t.finalize();const r=t.target.buffer,a=new Blob([r],{type:"video/mp4"}),g=URL.createObjectURL(a),s=document.createElement("a");s.href=g;const c=new Date,d=`${c.getFullYear().toString().slice(-2)}${String(c.getMonth()+1).padStart(2,"0")}${String(c.getDate()).padStart(2,"0")}_${String(c.getHours()).padStart(2,"0")}${String(c.getMinutes()).padStart(2,"0")}${String(c.getSeconds()).padStart(2,"0")}`;s.download=`image_video-${d}.mp4`,s.click(),y.textContent="完了 ✔"}),document.querySelector("#header button").addEventListener("click",()=>{document.querySelector(".anothertools").classList.add("on")}),document.querySelector(".anothertools .dialog__close").addEventListener("click",()=>{document.querySelector(".anothertools").classList.remove("on")});const h=document.querySelector(".smart__setting"),m=document.querySelector(".smart__preview");window.onresize=function(){window.innerWidth>680&&m.classList.contains("on")&&(h.classList.add("on"),m.classList.remove("on"),document.querySelector(".controls").classList.remove("off"))},h.addEventListener("click",()=>{h.classList.add("on"),m.classList.remove("on"),document.querySelector(".controls").classList.remove("off")}),m.addEventListener("click",()=>{m.classList.add("on"),h.classList.remove("on"),document.querySelector(".controls").classList.add("off")});const E=document.querySelector("dialog.download");document.querySelector("dialog.download .dialog__close").addEventListener("click",()=>{E.close()});
