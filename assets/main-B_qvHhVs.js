(function(){const o=document.createElement("link").relList;if(!(o&&o.supports&&o.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const t of i.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&s(t)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const i=function(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}(e);fetch(e.href,i)}})();const y=document.getElementById("imageInput"),c=document.getElementById("canvas"),f=c.getContext("2d"),p=document.getElementById("export"),h=document.getElementById("status");let a;y.addEventListener("change",()=>{const o=y.files[0];o&&(a=new Image,a.onload=()=>{c.width=a.naturalWidth,c.height=a.naturalHeight,f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",f.drawImage(a,0,0)},a.src=URL.createObjectURL(o))}),p.addEventListener("click",async()=>{if(!a)return alert("画像を読み込んでください");h.textContent="MP4生成中… 0%";const o=Math.floor(6),s=new Mp4Muxer.Muxer({target:new Mp4Muxer.ArrayBufferTarget,video:{codec:"avc",width:c.width,height:c.height},fastStart:"in-memory"}),e=new VideoEncoder({output:(r,u)=>s.addVideoChunk(r,u),error:r=>console.error(r)});e.configure({codec:"avc1.640028",width:c.width,height:c.height,bitrate:12e6,framerate:60});const i=await createImageBitmap(c);for(let r=0;r<o;r++){const u=new VideoFrame(i,{timestamp:16666.666666666668*r});e.encode(u),u.close(),h.textContent="MP4生成中… "+Math.round(r/o*100)+"%"}await e.flush(),e.close(),i.close(),s.finalize();const t=s.target.buffer,n=new Blob([t],{type:"video/mp4"}),L=URL.createObjectURL(n),g=document.createElement("a");g.href=L;const d=new Date,S=`${d.getFullYear().toString().slice(-2)}${String(d.getMonth()+1).padStart(2,"0")}${String(d.getDate()).padStart(2,"0")}_${String(d.getHours()).padStart(2,"0")}${String(d.getMinutes()).padStart(2,"0")}${String(d.getSeconds()).padStart(2,"0")}`;g.download=`image_video-${S}.mp4`,g.click(),h.textContent="完了 ✔"}),document.querySelector("#header button").addEventListener("click",()=>{document.querySelector(".anothertools").classList.add("on")}),document.querySelector(".anothertools .dialog__close").addEventListener("click",()=>{document.querySelector(".anothertools").classList.remove("on")});const m=document.querySelector(".smart__setting"),l=document.querySelector(".smart__preview");window.onresize=function(){window.innerWidth>680&&l.classList.contains("on")&&(m.classList.add("on"),l.classList.remove("on"),document.querySelector(".controls").classList.remove("off"))},m.addEventListener("click",()=>{m.classList.add("on"),l.classList.remove("on"),document.querySelector(".controls").classList.remove("off")}),l.addEventListener("click",()=>{l.classList.add("on"),m.classList.remove("on"),document.querySelector(".controls").classList.add("off")});const w=document.querySelector("dialog.download");document.querySelector("dialog.download .dialog__close").addEventListener("click",()=>{w.close()});
