(function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const r of d.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0})}function n(o){if(o.ep)return;o.ep=!0;const d=function(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}(o);fetch(o.href,d)}})();const v=document.getElementById("imageInput"),t=document.getElementById("canvas"),g=t.getContext("2d"),S=document.getElementById("export"),h=document.getElementById("status");let c;function p(e){e&&e.type.startsWith("image/")?(c=new Image,c.onload=()=>{t.width=c.naturalWidth,t.height=c.naturalHeight,g.imageSmoothingEnabled=!0,g.imageSmoothingQuality="high",g.clearRect(0,0,t.width,t.height),g.drawImage(c,0,0),h.textContent=`画像読み込み完了 (${t.width} x ${t.height})`},c.src=URL.createObjectURL(e)):alert("画像ファイルを選択してください")}v.addEventListener("change",()=>{p(v.files[0])}),["dragenter","dragover","dragleave","drop"].forEach(e=>{t.addEventListener(e,n=>{n.preventDefault(),n.stopPropagation()})}),["dragenter","dragover"].forEach(e=>{t.addEventListener(e,()=>{t.classList.add("dragover")})}),["dragleave","drop"].forEach(e=>{t.addEventListener(e,()=>{t.classList.remove("dragover")})}),t.addEventListener("drop",e=>{p(e.dataTransfer.files[0])}),S.addEventListener("click",async()=>{if(!c)return alert("画像を読み込んでください");h.textContent="MP4生成中… 0%";const e=Math.floor(30),n=new Mp4Muxer.Muxer({target:new Mp4Muxer.ArrayBufferTarget,video:{codec:"avc",width:t.width,height:t.height},fastStart:"in-memory"}),o=new VideoEncoder({output:(i,u)=>n.addVideoChunk(i,u),error:i=>console.error(i)});o.configure({codec:"avc1.640028",width:t.width,height:t.height,bitrate:12e6,framerate:60});const d=await createImageBitmap(t);for(let i=0;i<e;i++){const u=new VideoFrame(d,{timestamp:16666.666666666668*i});o.encode(u),u.close(),h.textContent="MP4生成中… "+Math.round(i/e*100)+"%"}await o.flush(),o.close(),d.close(),n.finalize();const r=n.target.buffer,a=new Blob([r],{type:"video/mp4"}),L=URL.createObjectURL(a),f=document.createElement("a");f.href=L;const s=new Date,y=`${s.getFullYear().toString().slice(-2)}${String(s.getMonth()+1).padStart(2,"0")}${String(s.getDate()).padStart(2,"0")}_${String(s.getHours()).padStart(2,"0")}${String(s.getMinutes()).padStart(2,"0")}${String(s.getSeconds()).padStart(2,"0")}`;f.download=`image_video-${y}.mp4`,f.click(),h.textContent="完了 ✔"}),document.querySelector("#header button").addEventListener("click",()=>{document.querySelector(".anothertools").classList.add("on")}),document.querySelector(".anothertools .dialog__close").addEventListener("click",()=>{document.querySelector(".anothertools").classList.remove("on")});const m=document.querySelector(".smart__setting"),l=document.querySelector(".smart__preview");window.onresize=function(){window.innerWidth>680&&l.classList.contains("on")&&(m.classList.add("on"),l.classList.remove("on"),document.querySelector(".controls").classList.remove("off"))},m.addEventListener("click",()=>{m.classList.add("on"),l.classList.remove("on"),document.querySelector(".controls").classList.remove("off")}),l.addEventListener("click",()=>{l.classList.add("on"),m.classList.remove("on"),document.querySelector(".controls").classList.add("off")});const w=document.querySelector("dialog.download");document.querySelector("dialog.download .dialog__close").addEventListener("click",()=>{w.close()});
